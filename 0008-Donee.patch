From ff7fbb34c3806e2fd7007a8c9401a30d8e8b0a89 Mon Sep 17 00:00:00 2001
From: Mohamad-Adwan <s1202827@stu.najah.edu>
Date: Tue, 15 Apr 2025 14:39:12 +0300
Subject: [PATCH 08/14] Donee

---
 backend/controllers/productController.js    |  4 +
 backend/models/productModel.js              |  1 +
 package-lock.json                           |  6 ++
 package.json                                |  1 +
 src/components/Footer.tsx                   |  8 +-
 src/components/ProductCard.tsx              | 24 ++++--
 src/components/admin/ProductsManagement.tsx | 17 +++-
 src/hooks/useAdminData.ts                   |  2 +-
 src/pages/AdminDashboard.tsx                | 19 +----
 src/pages/HomePage.tsx                      | 87 ++++++++++++++++++++-
 src/pages/ProductDetail.tsx                 | 24 ++++--
 src/types/index.ts                          |  1 +
 12 files changed, 156 insertions(+), 38 deletions(-)

diff --git a/backend/controllers/productController.js b/backend/controllers/productController.js
index 2e65d5a..c88112f 100644
--- a/backend/controllers/productController.js
+++ b/backend/controllers/productController.js
@@ -180,6 +180,7 @@ const productController = {
           },
           name: productData.name,
           price: productData.price,
+          discountprice:productData.discountprice,
           description: productData.description,
           stock: productData.stock,
           category: productData.category,
@@ -197,6 +198,7 @@ const productController = {
           price: productData.price,
           description: productData.description,
           stock: productData.stock,
+          discountprice:productData.discountprice,
           category: productData.category,
         },
         { new: true } // Return the updated document
@@ -252,6 +254,7 @@ const productController = {
           id1: product.id1,
           name: product.name,
           price: product.price,
+          discountprice:product.discountprice,
           description: product.description,
           stock: product.stock,
           category: product.category,
@@ -289,6 +292,7 @@ const formattedProduct = {
   id1: product.id1,
   name: product.name,
   price: product.price,
+  discountprice:product.discountprice,
   description: product.description,
   stock: product.stock,
   category: product.category,
diff --git a/backend/models/productModel.js b/backend/models/productModel.js
index efb8962..f3fd053 100644
--- a/backend/models/productModel.js
+++ b/backend/models/productModel.js
@@ -123,6 +123,7 @@ const productSchema = new mongoose.Schema({
   id1: { type: Number,unique: true }, // Auto-increment field
   name: { type: String, required: true },
   price: { type: Number, required: true },
+  discountprice:{type:Number},
   description: String,
   stock: Number,
   category: String,
diff --git a/package-lock.json b/package-lock.json
index 39681c7..e59468e 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -50,6 +50,7 @@
         "gridfs-stream": "^1.1.1",
         "input-otp": "^1.2.4",
         "jsonwebtoken": "^9.0.2",
+        "keen-slider": "^6.8.6",
         "lucide-react": "^0.462.0",
         "mongoose": "^8.13.2",
         "mongoose-sequence": "^6.0.1",
@@ -5951,6 +5952,11 @@
         "node": ">=12.0.0"
       }
     },
+    "node_modules/keen-slider": {
+      "version": "6.8.6",
+      "resolved": "https://registry.npmjs.org/keen-slider/-/keen-slider-6.8.6.tgz",
+      "integrity": "sha512-dcEQ7GDBpCjUQA8XZeWh3oBBLLmyn8aoeIQFGL/NTVkoEOsmlnXqA4QykUm/SncolAZYGsEk/PfUhLZ7mwMM2w=="
+    },
     "node_modules/keyv": {
       "version": "4.5.4",
       "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
diff --git a/package.json b/package.json
index 1c73cb7..88a65bb 100644
--- a/package.json
+++ b/package.json
@@ -53,6 +53,7 @@
     "gridfs-stream": "^1.1.1",
     "input-otp": "^1.2.4",
     "jsonwebtoken": "^9.0.2",
+    "keen-slider": "^6.8.6",
     "lucide-react": "^0.462.0",
     "mongoose": "^8.13.2",
     "mongoose-sequence": "^6.0.1",
diff --git a/src/components/Footer.tsx b/src/components/Footer.tsx
index fc128e2..1a97155 100644
--- a/src/components/Footer.tsx
+++ b/src/components/Footer.tsx
@@ -65,20 +65,20 @@ const Footer = () => {
             <h3 className="text-lg font-bold mb-4">Contact Info</h3>
             <ul className="space-y-2">
               <li className="text-muted-foreground text-sm">
-                Email: info@shopease.com
+                Email: info@techshop.com
               </li>
               <li className="text-muted-foreground text-sm">
-                Phone: (123) 456-7890
+                Phone: (+970) 595-642-327
               </li>
               <li className="text-muted-foreground text-sm">
-                Address: 123 Commerce St, City, Country
+                Address: Tulkrem, Palestine
               </li>
             </ul>
           </div>
         </div>
         
         <div className="border-t border-border mt-8 pt-8 text-center text-sm text-muted-foreground">
-          <p>Â© {new Date().getFullYear()} ShopEase. All rights reserved.</p>
+          <p>Â© {new Date().getFullYear()} Tech-Shop. All rights reserved.</p>
         </div>
       </div>
     </footer>
diff --git a/src/components/ProductCard.tsx b/src/components/ProductCard.tsx
index 52ce645..21bb96c 100644
--- a/src/components/ProductCard.tsx
+++ b/src/components/ProductCard.tsx
@@ -50,9 +50,9 @@ const ProductCard: React.FC<ProductCardProps> = ({ product }) => {
   return (
     <Card className="overflow-hidden h-full transition-all duration-200 hover:shadow-md flex flex-col">
       <div className="relative h-48 overflow-hidden">
-        {product.featured && (
+        {/* {product.featured && (
           <Badge className="absolute top-2 left-2 z-10">Featured</Badge>
-        )}
+        )} */}
         <img 
           src={product.image} 
           alt={product.name} 
@@ -69,10 +69,24 @@ const ProductCard: React.FC<ProductCardProps> = ({ product }) => {
       
       <CardFooter className="flex flex-col items-stretch gap-2 mt-auto">
         <div className="flex justify-between items-center w-full">
-          {isOnoff ? (
-            <span className="font-bold">${product.price.toFixed(2)}</span>
+        {isOnoff ? (
+            product.discountprice > 0 ? (
+              <div>
+               <div className="text-xl text-muted-foreground italic line-through">
+               {product.price}â‚ª
+                  </div>
+                <div className="text-2xl font-bold text-primary">
+                  {product.discountprice}â‚ª
+                </div>
+              </div>
+            ) : (
+              <div className="text-muted-foreground italic">
+                {product.price}â‚ª
+              </div>
+            )
           ) : (
-            <span className="text-muted-foreground italic"></span>
+            <div className="text-muted-foreground italic">
+            </div>
           )}
           <Badge variant="outline">{product.category}</Badge>
         </div>
diff --git a/src/components/admin/ProductsManagement.tsx b/src/components/admin/ProductsManagement.tsx
index 0b45b97..b06895f 100644
--- a/src/components/admin/ProductsManagement.tsx
+++ b/src/components/admin/ProductsManagement.tsx
@@ -736,6 +736,7 @@ const ProductsManagement: React.FC<ProductsManagementProps> = ({
       image: ' ',
       category: '',
       stock: 0,
+      discountprice:0,
       
     };
 
@@ -866,6 +867,7 @@ const ProductsManagement: React.FC<ProductsManagementProps> = ({
               <TableHead>Name</TableHead>
               <TableHead>Description</TableHead>
               <TableHead>Price</TableHead>
+              <TableHead>Discount price</TableHead>
               <TableHead>Category</TableHead>
               <TableHead>Stock</TableHead>
               <TableHead>Image</TableHead>
@@ -878,7 +880,8 @@ const ProductsManagement: React.FC<ProductsManagementProps> = ({
                 <TableCell>{product.id1}</TableCell>
                 <TableCell>{product.name}</TableCell>
                 <TableCell>{product.description}</TableCell>
-                <TableCell>${product.price}</TableCell>
+                <TableCell>{product.price}â‚ª</TableCell>
+                <TableCell>{product.discountprice}â‚ª</TableCell>
                 <TableCell>{product.category}</TableCell>
                 <TableCell>{product.stock}</TableCell>
                 
@@ -974,6 +977,18 @@ const ProductsManagement: React.FC<ProductsManagementProps> = ({
                   placeholder="Price"
                 />
               </div>
+              <div>
+                <label className="block text-sm font-medium text-muted-foreground mb-1">
+                Discount price
+                </label>
+                <Input
+                  name="discountprice"
+                  type="number"
+                  value={editingProduct.discountprice}
+                  onChange={handleChange}
+                  placeholder="Discount Price"
+                />
+              </div>
               <div>
                 <label className="block text-sm font-medium text-muted-foreground mb-1">
                   Category
diff --git a/src/hooks/useAdminData.ts b/src/hooks/useAdminData.ts
index 74704bb..7e5865a 100644
--- a/src/hooks/useAdminData.ts
+++ b/src/hooks/useAdminData.ts
@@ -134,7 +134,7 @@ export const useAdminData = () => {
   useEffect(() => {
     if ((ordersError || usersError) && !useMockData) {
       setUseMockData(true);
-      toast.info('Using sample data since the API is unavailable');
+      //toast.info('Using sample data since the API is unavailable');
     }
   }, [ordersError, usersError, useMockData]);
   
diff --git a/src/pages/AdminDashboard.tsx b/src/pages/AdminDashboard.tsx
index aad9a78..237eef7 100644
--- a/src/pages/AdminDashboard.tsx
+++ b/src/pages/AdminDashboard.tsx
@@ -59,30 +59,13 @@ const AdminDashboard = () => {
     handleDeleteUser
   } = useAdminData();
   
-  if (!user || user.role !== 'admin') {
-    return <Navigate to="/" />;
-  }
-  
-  const ApiErrorBanner = () => {
-    if (!useMockData) return null;
-    
-    return (
-      <Alert variant="destructive">
-        <AlertTriangle className="h-4 w-4" />
-        <AlertTitle>API Connection Issue</AlertTitle>
-        <AlertDescription>
-          We couldn't connect to the backend API. You are currently viewing sample data.
-        </AlertDescription>
-      </Alert>
-    );
-  };
   
   return (
     <div className="container mx-auto px-4 py-8">
       <h1 className="text-3xl font-bold mb-2">Admin Dashboard</h1>
       <p className="text-muted-foreground mb-4">Manage your store</p>
       
-      <ApiErrorBanner />
+      
       
       <Tabs defaultValue="overview" value={activeTab} onValueChange={setActiveTab} className="w-full">
         <TabsList className="grid grid-cols-4 mb-8">
diff --git a/src/pages/HomePage.tsx b/src/pages/HomePage.tsx
index 2eebe15..b20e922 100644
--- a/src/pages/HomePage.tsx
+++ b/src/pages/HomePage.tsx
@@ -103,6 +103,8 @@ import ProductCard from '@/components/ProductCard';
 import { getFeaturedProducts } from '@/data/products';
 import React, { createContext, useContext, useState, useEffect } from 'react';
 import { productApi } from '@/services/apiService';
+import { useKeenSlider } from 'keen-slider/react'
+import 'keen-slider/keen-slider.min.css'
 
 const HomePage = () => {
   const [cartItems, setCartItems] = useState<Product[]>([]);
@@ -116,6 +118,7 @@ const HomePage = () => {
     category: string;
     stock: number;
     featured?: boolean;
+    discountprice:number;
 
     
   };
@@ -132,7 +135,67 @@ const HomePage = () => {
     };
     fetchCartItems();
   }, []);
+ 
+ 
 
+  const discountedProducts = products.filter(
+    (product) => product.discountprice && product.discountprice > 0
+  );
+  
+  function AutoplayPlugin(slider) {
+    let timeout;
+    let mouseOver = false;
+  
+    function clearNextTimeout() {
+      clearTimeout(timeout);
+    }
+  
+    function nextTimeout() {
+      clearTimeout(timeout);
+      if (mouseOver) return;
+      timeout = setTimeout(() => {
+        slider.next();
+      }, 2500);
+    }
+  
+    slider.on("created", () => {
+      slider.container.addEventListener("mouseover", () => {
+        mouseOver = true;
+        clearNextTimeout();
+      });
+      slider.container.addEventListener("mouseout", () => {
+        mouseOver = false;
+        nextTimeout();
+      });
+      nextTimeout();
+    });
+  
+    slider.on("dragStarted", clearNextTimeout);
+    slider.on("animationEnded", nextTimeout);
+    slider.on("updated", nextTimeout);
+  }
+  const [sliderRef,slider] = useKeenSlider({
+    loop: true,
+    slides: {
+      perView: 3,
+      spacing: 15,
+    },
+    breakpoints: {
+      "(max-width: 768px)": {
+        slides: { perView: 1 },
+      },
+    },
+  }, [AutoplayPlugin]);
+  
+  useEffect(() => {
+      let interval
+      if (slider.current) {
+        interval = setInterval(() => {
+          slider.current?.next()
+        }, 3000) // Change every 3 seconds
+      }
+      return () => clearInterval(interval)
+    }, [slider])
   // Fetch 9 featured products
   useEffect(() => {
     const fetchProducts = async () => {
@@ -166,7 +229,6 @@ const HomePage = () => {
             </h1>
             <p className="text-lg text-muted-foreground mb-8">
               Discover our premium selection of products for all your needs.
-              Login to see prices and enjoy exclusive features.
             </p>
             <div className="flex flex-col sm:flex-row gap-4 justify-center">
               <Button size="lg" asChild>
@@ -176,7 +238,26 @@ const HomePage = () => {
           </div>
         </div>
       </section>
-      
+
+      {products.some(product => product.discountprice && product.discountprice > 0) && (
+  <div className="my-6">
+    <h2 className="text-xl font-bold mb-4">ðŸ”¥ Discounted Products</h2>
+    <div ref={sliderRef} className="keen-slider">
+      {products
+        .filter(product => product.discountprice && product.discountprice > 0)
+        .map((product, index) => (
+          <div className="keen-slider__slide bg-white p-4 rounded-lg shadow" key={index}>
+            <div key={product.id1}>
+                <ProductCard product={product} />
+                
+              </div>
+          </div>
+        ))}
+    </div>
+  </div>
+)}
+
+
       {/* Featured Products */}
       <section className="py-16">
         <div className="container mx-auto px-4">
@@ -187,7 +268,7 @@ const HomePage = () => {
             </Link>
           </div>
           
-          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6">
+          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
             {products.map((product) => (
               <div key={product.id1}>
                 <ProductCard product={product} />
diff --git a/src/pages/ProductDetail.tsx b/src/pages/ProductDetail.tsx
index 2edfcf1..31b9b58 100644
--- a/src/pages/ProductDetail.tsx
+++ b/src/pages/ProductDetail.tsx
@@ -77,12 +77,12 @@ const ProductDetail = () => {
       
       <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
         {/* Product Image */}
-        <div className="aspect-square overflow-hidden rounded-lg">
+        {/* <div className="aspect-square overflow-hidden rounded-lg"> */}
+        <div className=" overflow-hidden rounded-lg">
           <img 
             src={product.image} 
             alt={product.name} 
-            className="w-full h-full object-cover"
-          />
+            className="h-full w-full object-cover transition-transform duration-300 hover:scale-105"          />
         </div>
         
         {/* Product Details */}
@@ -94,10 +94,22 @@ const ProductDetail = () => {
             </Badge>
           </div>
           
+
           {isOnoff ? (
-            <div className="text-2xl font-bold text-primary">
-              ${product.price}
-            </div>
+            product.discountprice > 0 ? (
+              <div>
+               <div className="text-xl text-muted-foreground italic line-through">
+               {product.price}â‚ª
+                  </div>
+                <div className="text-2xl font-bold text-primary">
+                  {product.discountprice}â‚ª
+                </div>
+              </div>
+            ) : (
+              <div className="text-muted-foreground italic">
+                {product.price}â‚ª
+              </div>
+            )
           ) : (
             <div className="text-muted-foreground italic">
             </div>
diff --git a/src/types/index.ts b/src/types/index.ts
index 8c3ece4..49539eb 100644
--- a/src/types/index.ts
+++ b/src/types/index.ts
@@ -9,6 +9,7 @@ export interface Product {
   category: string;
   featured?: boolean;
   stock: number;
+  discountprice:number;
 }
 
 export interface User {
-- 
2.45.1.windows.1

